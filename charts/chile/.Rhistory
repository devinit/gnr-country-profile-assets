,legend.box = "vertical"
,legend.text = element_text(size=25,color=blue,family="Averta Regular")
,legend.justification=c(0,0)
,legend.box.just = "left"
,legend.direction="vertical"
,axis.title.x=element_blank()
,axis.title.y=element_text(size=20,color=blue,family="Averta Regular")
,axis.ticks=element_blank()
,axis.line.y = element_blank()
,axis.line.x = element_line(color=blue, size = 1.1)
,axis.text.y = element_text(size=25,color=dark.grey,family="Averta Regular")
,axis.text.x = element_text(size=25,color=blue,margin=margin(t=20,r=0,b=0,l=0),family="Averta Regular")
,panel.grid.major.y = element_line(color=dark.grey)
,legend.background = element_rect(fill = "transparent", colour = "transparent")
,legend.key.width = unit(1,"cm")
) + labs(y = y.lab)
}else{
c35 = NULL
}
}
if(this.country %in% unique(dat_reg$country)){
indicators = c("oda_per_capita")
c35names = c("Basic nutrition ODA received")
y.lab = "ODA, US$, per 1,000 people"
c35data = subset(countrydat,indicator %in% indicators)
c35data$value = as.numeric(c35data$value)
c35data = subset(c35data, !is.na(value))
if(sum(c35data$value)>0){
c35data = c35data[,c("year","indicator","value")]
c35.oda.max <- max(c35data$value,na.rm=TRUE)
for(j in 1:length(indicators)){
ind = indicators[j]
indname = c35names[j]
c35data$indicator[which(c35data$indicator==ind)] = indname
}
c35.key.data.1 = data.frame(year=as.numeric(rep(NA,1)),indicator=c35names[1],value=as.numeric(rep(NA,1)))
c35 = ggplot(c35data,aes(x=year,y=value)) +
geom_area(alpha=1,show.legend=F,color=blue,size=0,fill=yellow) +
geom_point(data=c35.key.data.1,aes(group=indicator,fill=indicator),size=12,color=blue,stroke=0,shape=22) +
yellowFill +
guides(fill=guide_legend(title=element_blank(),byrow=TRUE),color=guide_legend(title=element_blank(),byrow=TRUE)) +
simple_style  +
scale_y_continuous(
expand = c(0,0),
limits=c(0,max(c35.oda.max*1.1,1)),
) +
scale_x_continuous(breaks = seq(min(c35data$year),max(c35data$year),by=3)) +
theme(
legend.position="top"
,legend.box = "vertical"
,legend.text = element_text(size=25,color=blue,family="Averta Regular")
,legend.justification=c(0,0)
,legend.box.just = "left"
,legend.direction="vertical"
,axis.title.x=element_blank()
,axis.title.y=element_text(size=20,color=blue,family="Averta Regular")
,axis.ticks=element_blank()
,axis.line.y = element_blank()
,axis.line.x = element_line(color=blue, size = 1.1)
,axis.text.y = element_text(size=25,color=dark.grey,family="Averta Regular")
,axis.text.x = element_text(size=25,color=blue,margin=margin(t=20,r=0,b=0,l=0),family="Averta Regular")
,panel.grid.major.y = element_line(color=dark.grey)
,legend.background = element_rect(fill = "transparent", colour = "transparent")
,legend.key.width = unit(1,"cm")
) + labs(y = y.lab)
}else{
c35 = NULL
}
}
if(this.country=="Global"){
c35names = c("% of total ODA","Basic nutrition ODA received")
indicators=c("ODA_received_percent","ODA_received")
y.lab = "ODA, US$ millions"
c35data = subset(countrydat,indicator %in% indicators)
if(!empty(c35data)){
c35data$value = as.numeric(c35data$value)
c35data = subset(c35data, !is.na(value))
c35data = c35data[c("year","indicator","value")]
c35.oda.max <- max(subset(c35data,indicator==indicators[2])$value,na.rm=TRUE)
c35.perc.max <- max(subset(c35data,indicator==indicators[1])$value,na.rm=TRUE)
# Why *1.25? Need to sort.
c35.ratio = (c35.oda.max/c35.perc.max)*1.25
c35.oda.max = c35.oda.max*1.25
for(j in 1:length(indicators)){
ind = indicators[j]
indname = c35names[j]
c35data$indicator[which(c35data$indicator==ind)] = indname
}
c35.key.data.2 = data.frame(year=as.numeric(rep(NA,1)),indicator=c35names[2],value=as.numeric(rep(NA,1)))
c35.key.data.1 = data.frame(year=as.numeric(rep(NA,1)),indicator=c35names[1],value=as.numeric(rep(NA,1)))
c35 = ggplot(subset(c35data,indicator==c35names[2]),aes(x=year,y=value)) +
geom_area(alpha=1,show.legend=F,color="transparent",fill=yellow) +
geom_point(data=c35.key.data.2,aes(group=indicator,fill=indicator),size=12,color="transparent",stroke=0,shape=22) +
geom_line(data=subset(c35data,indicator==c35names[1]),aes(y=value*c35.ratio,color=indicator),size=2) +
yellowFill +
orangeColor +
guides(fill=guide_legend(title=element_blank(),byrow=TRUE),color=guide_legend(title=element_blank(),byrow=TRUE)) +
simple_style  +
scale_y_continuous(
expand = c(0,0),
limits=c(0,max(c35.oda.max*1.1,1)),
sec.axis = sec_axis(~./c35.ratio, name="% of total ODA")
) +
scale_x_continuous(breaks = seq(min(c35data$year),max(c35data$year),by=3)) +
theme(
legend.position="top"
,legend.box = "vertical"
,legend.text = element_text(size=25,color=blue,family="Averta Regular")
,legend.justification=c(0,0)
,legend.box.just = "left"
,legend.direction="vertical"
,axis.title.x=element_blank()
,axis.title.y=element_text(size=20,color=blue,family="Averta Regular")
,axis.ticks=element_blank()
,axis.line.y = element_blank()
,axis.line.x = element_line(color=blue, size = 1.1)
,axis.text.y = element_text(size=25,color=dark.grey,family="Averta Regular")
,axis.text.x = element_text(size=25,color=blue,margin=margin(t=20,r=0,b=0,l=0),family="Averta Regular")
,panel.grid.major.y = element_line(color=dark.grey)
,legend.background = element_rect(fill = "transparent", colour = "transparent")
,legend.key.width = unit(1,"cm")
) + labs(y = y.lab)
}
}
c35
indicators = c("ODA_received","ODA_received_percent","ODA_basic_disbursed","ODA_basic_disbursed_percent")
if(!is.na(recipient)){
if(recipient){
c35names = c("% of total ODA","Basic nutrition ODA received")
indicators=c("ODA_received_percent","ODA_received")
y.lab = "ODA, US$ millions"
}else{
c35names = c("% of total ODA","Basic nutrition ODA disbursed")
indicators=c("ODA_basic_disbursed_percent","ODA_basic_disbursed")
y.lab = "ODA, US$ millions"
}
}
c35data = subset(countrydat,indicator %in% indicators)
View(c35data)
!(unique(as.numeric(c35data$value))==0)
unique(as.numeric(c35data$value))
c(0,0,0,0,0,0)
unique(c(0,0,0,0,0))
!empty(c35data) && !(unique(as.numeric(c35data$value))==0)
!(unique(as.numeric(c35data$value))==0)
!empty(c35data)
unique(c(1,0,0,0))
c35data = subset(c35data, !is.na(value))
unique(as.numeric(c35data$value))==0
as.numeric(c35data$value)
unique(as.numeric(c35data$value))
length(unique(as.numeric(c35data$value)))
if(this.country %in% unique(dat_country$country)){
indicators = c("ODA_received","ODA_received_percent","ODA_basic_disbursed","ODA_basic_disbursed_percent")
if(!is.na(recipient)){
if(recipient){
c35names = c("% of total ODA","Basic nutrition ODA received")
indicators=c("ODA_received_percent","ODA_received")
y.lab = "ODA, US$ millions"
}else{
c35names = c("% of total ODA","Basic nutrition ODA disbursed")
indicators=c("ODA_basic_disbursed_percent","ODA_basic_disbursed")
y.lab = "ODA, US$ millions"
}
}
c35data = subset(countrydat,indicator %in% indicators)
if(!empty(c35data) && !(length(unique(as.numeric(c35data$value)))==1)){
c35data$value = as.numeric(c35data$value)
c35data = subset(c35data, !is.na(value))
c35data = c35data[c("year","indicator","value")]
c35.oda.max <- max(subset(c35data,indicator==indicators[2])$value,na.rm=TRUE)
c35.perc.max <- max(subset(c35data,indicator==indicators[1])$value,na.rm=TRUE)
# Why *1.25? Need to sort.
c35.ratio = (c35.oda.max/c35.perc.max)*1.25
c35.oda.max = c35.oda.max*1.25
for(j in 1:length(indicators)){
ind = indicators[j]
indname = c35names[j]
c35data$indicator[which(c35data$indicator==ind)] = indname
}
c35.key.data.2 = data.frame(year=as.numeric(rep(NA,1)),indicator=c35names[2],value=as.numeric(rep(NA,1)))
c35.key.data.1 = data.frame(year=as.numeric(rep(NA,1)),indicator=c35names[1],value=as.numeric(rep(NA,1)))
c35 = ggplot(subset(c35data,indicator==c35names[2]),aes(x=year,y=value)) +
geom_area(alpha=1,show.legend=F,color="transparent",fill=yellow) +
geom_point(data=c35.key.data.2,aes(group=indicator,fill=indicator),size=12,color="transparent",stroke=0,shape=22) +
geom_line(data=subset(c35data,indicator==c35names[1]),aes(y=value*c35.ratio,color=indicator),size=2) +
yellowFill +
orangeColor +
guides(fill=guide_legend(title=element_blank(),byrow=TRUE),color=guide_legend(title=element_blank(),byrow=TRUE)) +
simple_style  +
scale_y_continuous(
expand = c(0,0),
limits=c(0,max(c35.oda.max*1.1,1)),
sec.axis = sec_axis(~./c35.ratio, name="% of total ODA")
) +
scale_x_continuous(breaks = seq(min(c35data$year),max(c35data$year),by=3)) +
theme(
legend.position="top"
,legend.box = "vertical"
,legend.text = element_text(size=25,color=blue,family="Averta Regular")
,legend.justification=c(0,0)
,legend.box.just = "left"
,legend.direction="vertical"
,axis.title.x=element_blank()
,axis.title.y=element_text(size=20,color=blue,family="Averta Regular")
,axis.ticks=element_blank()
,axis.line.y = element_blank()
,axis.line.x = element_line(color=blue, size = 1.1)
,axis.text.y = element_text(size=25,color=dark.grey,family="Averta Regular")
,axis.text.x = element_text(size=25,color=blue,margin=margin(t=20,r=0,b=0,l=0),family="Averta Regular")
,panel.grid.major.y = element_line(color=dark.grey)
,legend.background = element_rect(fill = "transparent", colour = "transparent")
,legend.key.width = unit(1,"cm")
) + labs(y = y.lab)
}else{
c35 = NULL
}
}
if(this.country %in% unique(dat_reg$country)){
indicators = c("oda_per_capita")
c35names = c("Basic nutrition ODA received")
y.lab = "ODA, US$, per 1,000 people"
c35data = subset(countrydat,indicator %in% indicators)
c35data$value = as.numeric(c35data$value)
c35data = subset(c35data, !is.na(value))
if(sum(c35data$value)>0){
c35data = c35data[,c("year","indicator","value")]
c35.oda.max <- max(c35data$value,na.rm=TRUE)
for(j in 1:length(indicators)){
ind = indicators[j]
indname = c35names[j]
c35data$indicator[which(c35data$indicator==ind)] = indname
}
c35.key.data.1 = data.frame(year=as.numeric(rep(NA,1)),indicator=c35names[1],value=as.numeric(rep(NA,1)))
c35 = ggplot(c35data,aes(x=year,y=value)) +
geom_area(alpha=1,show.legend=F,color=blue,size=0,fill=yellow) +
geom_point(data=c35.key.data.1,aes(group=indicator,fill=indicator),size=12,color=blue,stroke=0,shape=22) +
yellowFill +
guides(fill=guide_legend(title=element_blank(),byrow=TRUE),color=guide_legend(title=element_blank(),byrow=TRUE)) +
simple_style  +
scale_y_continuous(
expand = c(0,0),
limits=c(0,max(c35.oda.max*1.1,1)),
) +
scale_x_continuous(breaks = seq(min(c35data$year),max(c35data$year),by=3)) +
theme(
legend.position="top"
,legend.box = "vertical"
,legend.text = element_text(size=25,color=blue,family="Averta Regular")
,legend.justification=c(0,0)
,legend.box.just = "left"
,legend.direction="vertical"
,axis.title.x=element_blank()
,axis.title.y=element_text(size=20,color=blue,family="Averta Regular")
,axis.ticks=element_blank()
,axis.line.y = element_blank()
,axis.line.x = element_line(color=blue, size = 1.1)
,axis.text.y = element_text(size=25,color=dark.grey,family="Averta Regular")
,axis.text.x = element_text(size=25,color=blue,margin=margin(t=20,r=0,b=0,l=0),family="Averta Regular")
,panel.grid.major.y = element_line(color=dark.grey)
,legend.background = element_rect(fill = "transparent", colour = "transparent")
,legend.key.width = unit(1,"cm")
) + labs(y = y.lab)
}else{
c35 = NULL
}
}
if(this.country=="Global"){
c35names = c("% of total ODA","Basic nutrition ODA received")
indicators=c("ODA_received_percent","ODA_received")
y.lab = "ODA, US$ millions"
c35data = subset(countrydat,indicator %in% indicators)
if(!empty(c35data)){
c35data$value = as.numeric(c35data$value)
c35data = subset(c35data, !is.na(value))
c35data = c35data[c("year","indicator","value")]
c35.oda.max <- max(subset(c35data,indicator==indicators[2])$value,na.rm=TRUE)
c35.perc.max <- max(subset(c35data,indicator==indicators[1])$value,na.rm=TRUE)
# Why *1.25? Need to sort.
c35.ratio = (c35.oda.max/c35.perc.max)*1.25
c35.oda.max = c35.oda.max*1.25
for(j in 1:length(indicators)){
ind = indicators[j]
indname = c35names[j]
c35data$indicator[which(c35data$indicator==ind)] = indname
}
c35.key.data.2 = data.frame(year=as.numeric(rep(NA,1)),indicator=c35names[2],value=as.numeric(rep(NA,1)))
c35.key.data.1 = data.frame(year=as.numeric(rep(NA,1)),indicator=c35names[1],value=as.numeric(rep(NA,1)))
c35 = ggplot(subset(c35data,indicator==c35names[2]),aes(x=year,y=value)) +
geom_area(alpha=1,show.legend=F,color="transparent",fill=yellow) +
geom_point(data=c35.key.data.2,aes(group=indicator,fill=indicator),size=12,color="transparent",stroke=0,shape=22) +
geom_line(data=subset(c35data,indicator==c35names[1]),aes(y=value*c35.ratio,color=indicator),size=2) +
yellowFill +
orangeColor +
guides(fill=guide_legend(title=element_blank(),byrow=TRUE),color=guide_legend(title=element_blank(),byrow=TRUE)) +
simple_style  +
scale_y_continuous(
expand = c(0,0),
limits=c(0,max(c35.oda.max*1.1,1)),
sec.axis = sec_axis(~./c35.ratio, name="% of total ODA")
) +
scale_x_continuous(breaks = seq(min(c35data$year),max(c35data$year),by=3)) +
theme(
legend.position="top"
,legend.box = "vertical"
,legend.text = element_text(size=25,color=blue,family="Averta Regular")
,legend.justification=c(0,0)
,legend.box.just = "left"
,legend.direction="vertical"
,axis.title.x=element_blank()
,axis.title.y=element_text(size=20,color=blue,family="Averta Regular")
,axis.ticks=element_blank()
,axis.line.y = element_blank()
,axis.line.x = element_line(color=blue, size = 1.1)
,axis.text.y = element_text(size=25,color=dark.grey,family="Averta Regular")
,axis.text.x = element_text(size=25,color=blue,margin=margin(t=20,r=0,b=0,l=0),family="Averta Regular")
,panel.grid.major.y = element_line(color=dark.grey)
,legend.background = element_rect(fill = "transparent", colour = "transparent")
,legend.key.width = unit(1,"cm")
) + labs(y = y.lab)
}
}
# Charts 36-55
legendtypes = rep(c(F,F,F,T),100)
legendtypes[35]=F
i=36
for (indic in c("exclusive_breastfeeding","continued_breastfeeding_1yr","minimum_accept_diet","solid_foods"))
{
legendtype = legendtypes[i]
# if(empty(as.name(paste0("c",as.character(i-1)))) && legendtypes[i-1]==TRUE){
#   legendtypes[i]=TRUE
#   legendtype = legendtypes[i]}
indic_dat = subset(countrydat,indicator==indic & disaggregation=="gender" & !is.na(value))
disaggs = unique(indic_dat$disagg.value)
disaggs = sort(disaggs,decreasing=T)
name=paste0("c",as.character(i))
indic_years = data.table(indic_dat)[,.(count=nrow(.SD)),by=.(year)]
max_indic_count = max(max(indic_years$count,na.rm=T),1)
indic_years = max(subset(indic_years,count==max_indic_count)$year)
if(nrow(indic_dat)==length(unique(indic_dat$year)) && nrow(indic_dat)>0){
assign(name,grouped_bar(indic_dat, indic,"gender",c("Boys","Girls","Both"),fill=YellowRedGrey,legend=legendtype,byrow=T,nrow=2,subset.years=indic_years))
} else if(nrow(indic_dat)>length(unique(indic_dat$year))){
if (length(unique(indic_dat$year))<2)
{
assign(name,grouped_bar_line(indic_dat, indic,"gender",c("Boys","Girls","Both"),fill=YellowRedGrey,legend=legendtype,byrow=T,nrow=2,subset.years=indic_years))
}else{assign(name,grouped_line(countrydat, indic,"gender",c("Boys","Girls","Both"),color=YellowRedGreyColor,fill=YellowRedGreyFill,legend=legendtype,factor.years=F))}
}else if(legendtypes[i]==TRUE){assign(name,NULL)
legendtypes[i+1]=TRUE
} else {assign(name,NULL)}
i=i+1}
i=40
for (indic in c("exclusive_breastfeeding","continued_breastfeeding_1yr","minimum_accept_diet","solid_foods"))
{
legendtype = legendtypes[i]
# if(is.null(name) && legendtypes[i-1]==TRUE){
#   legendtypes[i]=TRUE
#   legendtype = legendtypes[i]}
indic_dat = subset(countrydat,indicator==indic & disaggregation %in% c("location","gender") & !(disagg.value %in% c("Boys","Girls")) & !is.na(value))
disaggs = unique(indic_dat$disagg.value)
disaggs = sort(disaggs,decreasing=T)
name=paste0("c",as.character(i))
indic_years = data.table(indic_dat)[,.(count=nrow(.SD)),by=.(year)]
max_indic_count = max(max(indic_years$count,na.rm=T),1)
indic_years = max(subset(indic_years,count==max_indic_count)$year)
if(nrow(indic_dat)==length(unique(indic_dat$year)) && nrow(indic_dat)>0){
assign(name,grouped_bar(indic_dat, indic,c("location","gender"),c("Urban","Rural","Both"),fill=YellowRedGrey,legend=legendtype,byrow=T,nrow=2,subset.years=indic_years))
}else if(nrow(indic_dat)>length(unique(indic_dat$year))){
if (length(unique(indic_dat$year))<2)
{
assign(name,grouped_bar_line(indic_dat, indic,c("location","gender"),c("Urban","Rural","Both"),legend=legendtype,fill=YellowRedGrey,byrow=T,nrow=2,subset.years=indic_years))
}else{assign(name,grouped_line(countrydat, indic,c("location","gender"),c("Urban","Rural","Both"),legend=legendtype,color=YellowRedGreyColor,fill=YellowRedGreyFill,factor.years=F))}
}else if(legendtypes[i]==TRUE){assign(name,NULL)
legendtypes[i+1]=TRUE
} else {assign(name,NULL)}
i=i+1}
i=44
for (indic in c("exclusive_breastfeeding","continued_breastfeeding_1yr","minimum_accept_diet","solid_foods"))
{
legendtype = legendtypes[i]
# if(is.null(paste0("c",as.character(i-1))) && legendtypes[i-1]==TRUE){
#   legendtypes[i]=TRUE
#   legendtype = legendtypes[i]}
indic_dat = subset(countrydat,indicator==indic & disaggregation %in% c("income","gender") & !(disagg.value %in% c("Boys","Girls")) & !is.na(value))
disaggs = unique(indic_dat$disagg.value)
disaggs = sort(disaggs,decreasing=T)
name=paste0("c",as.character(i))
indic_years = data.table(indic_dat)[,.(count=nrow(.SD)),by=.(year)]
max_indic_count = max(max(indic_years$count,na.rm=T),1)
indic_years = max(subset(indic_years,count==max_indic_count)$year)
if(nrow(indic_dat)==length(unique(indic_dat$year)) && nrow(indic_dat)>0){
assign(name,grouped_bar(indic_dat, indic,c("income","gender"),c("Lowest","Second lowest","Middle","Second highest","Highest","Both"),fill=c(red, orange, yellow, lighter.blue, light.blue,grey),legend=legendtype,byrow=T,nrow=2,subset.years=indic_years))
}else if(nrow(indic_dat)>length(unique(indic_dat$year))){
if (length(unique(indic_dat$year))<2)
{
assign(name,grouped_bar_line(indic_dat, indic,c("income","gender"),c("Lowest","Second lowest","Middle","Second highest","Highest","Both"),legend=legendtype,fill=c(red, orange, yellow, lighter.blue, light.blue,grey),byrow=T,nrow=2,subset.years=indic_years))
}else{assign(name,grouped_line(countrydat, indic,c("income","gender"),c("Lowest","Second lowest","Middle","Second highest","Highest","Both"),legend=legendtype,color=sixColor,fill=sixFill,factor.years=F))}
}else if(legendtypes[i]==TRUE){assign(name,NULL)
legendtypes[i+1]=TRUE
} else {assign(name,NULL)}
i=i+1}
i=48
for (indic in c("exclusive_breastfeeding","continued_breastfeeding_1yr","minimum_accept_diet","solid_foods"))
{
legendtype = legendtypes[i]
# if(is.null(paste0("c",as.character(i-1))) && legendtypes[i-1]==TRUE){
#   legendtypes[i]=TRUE
#   legendtype = legendtypes[i]}
indic_dat = subset(countrydat,indicator==indic & disaggregation %in% c("education","gender") & (disagg.value %in% c("None or primary","Secondary or higher","Both")) & !is.na(value))
disaggs = unique(indic_dat$disagg.value)
disaggs = sort(disaggs,decreasing=T)
name=paste0("c",as.character(i))
indic_years = data.table(indic_dat)[,.(count=nrow(.SD)),by=.(year)]
max_indic_count = max(max(indic_years$count,na.rm=T),1)
indic_years = max(subset(indic_years,count==max_indic_count)$year)
if(nrow(indic_dat)==length(unique(indic_dat$year)) && nrow(indic_dat)>0){
assign(name,grouped_bar(indic_dat, indic,c("education","gender"),c("None or primary","Secondary or higher","Both"),fill=YellowRedGrey,legend=legendtype,byrow=T,nrow=2,subset.years=indic_years))
}else if(nrow(indic_dat)>length(unique(indic_dat$year))){
if (length(unique(indic_dat$year))<2)
{
assign(name,grouped_bar_line(indic_dat, indic,c("education","gender"),c("None or primary","Secondary or higher","Both"),fill=YellowRedGrey,legend=legendtype,byrow=T,nrow=2,subset.years=indic_years))
}else{assign(name,grouped_line(countrydat, indic,c("education","gender"),c("None or primary","Secondary or higher","Both"),legend=legendtype,color=YellowRedGreyColor,fill=YellowRedGreyFill,factor.years=F))}
}else if(legendtypes[i]==TRUE){assign(name,NULL)
legendtypes[i+1]=TRUE
} else {assign(name,NULL)}
i=i+1}
i=52
for (indic in c("exclusive_breastfeeding"))
{
legendtype = legendtypes[i]
# if(is.null(paste0("c",as.character(i-1))) && legendtypes[i-1]==TRUE){
#   legendtypes[i]=TRUE
#   legendtype = legendtypes[i]}
indic_dat = subset(countrydat,indicator==indic & disaggregation %in% c("age","gender") & (disagg.value %in% c("0-1 month","2-3 months","4-5 months","Both")) & !is.na(value))
disaggs = unique(indic_dat$disagg.value)
disaggs = sort(disaggs,decreasing=T)
name=paste0("c",as.character(i))
indic_years = data.table(indic_dat)[,.(count=nrow(.SD)),by=.(year)]
max_indic_count = max(max(indic_years$count,na.rm=T),1)
indic_years = max(subset(indic_years,count==max_indic_count)$year)
if(nrow(indic_dat)==length(unique(indic_dat$year)) && nrow(indic_dat)>0){
assign(name,grouped_bar(indic_dat, indic,c("age","gender"),c("0-1 month","2-3 months","4-5 months","Both"),fill=fourFillValues,legend=legendtype,byrow=T,nrow=2,subset.years=indic_years))
}else if(nrow(indic_dat)>length(unique(indic_dat$year))){
if (length(unique(indic_dat$year))<2)
{
assign(name,grouped_bar_line(indic_dat, indic,c("age","gender"),c("0-1 month","2-3 months","4-5 months","Both"),fill=fourFillValues,legend=legendtype,byrow=T,nrow=2,subset.years=indic_years))
}else{assign(name,grouped_line(countrydat, indic,c("age","gender"),c("0-1 month","2-3 months","4-5 months","Both"),legend=legendtype,color=fourColor,fill=fourFill,factor.years=F))}
}else if(legendtypes[i]==TRUE){assign(name,NULL)
legendtypes[i+2]=TRUE
} else {assign(name,NULL)}
i=i+2}
c53=NULL
c55=NULL
i=54
for (indic in c("minimum_accept_diet"))
{
legendtype = TRUE
indic_dat = subset(countrydat,indicator==indic & disaggregation %in% c("age","gender") & (disagg.value %in% c("6-11 months","12-15 months","16-19 months","20-23 months","Both")) & !is.na(value))
disaggs = unique(indic_dat$disagg.value)
disaggs = sort(disaggs,decreasing=T)
name=paste0("c",as.character(i))
indic_years = data.table(indic_dat)[,.(count=nrow(.SD)),by=.(year)]
max_indic_count = max(max(indic_years$count,na.rm=T),1)
indic_years = max(subset(indic_years,count==max_indic_count)$year)
if(nrow(indic_dat)==length(unique(indic_dat$year)) && nrow(indic_dat)>0){
assign(name,grouped_bar(indic_dat, indic,c("age","gender"),c("6-11 months","12-15 months","16-19 months","20-23 months","Both"),fill=quintileGreyFillValues,legend=legendtype,byrow=T,nrow=2,subset.years=indic_years))
}else if(nrow(indic_dat)>length(unique(indic_dat$year))){
if (length(unique(indic_dat$year))<2)
{
assign(name,grouped_bar_line(indic_dat, indic,c("age","gender"),c("6-11 months","12-15 months","16-19 months","20-23 months","Both"),legend=legendtype,fill=quintileGreyFillValues,byrow=T,nrow=2,subset.years=indic_years))
}else{assign(name,grouped_line(countrydat, indic,c("age","gender"),c("6-11 months","12-15 months","16-19 months","20-23 months","Both"),legend=legendtype,color=quintileGreyColor,fill=quintileGreyFill,factor.years=F))}
}else{assign(name,NULL)}
i=i+2}
subset_na = subset(subset(countrydat,indicator=="lbw"),!is.na(value))
if (nrow(subset_na)>0){
subset_na$disagg.value = "all"
subset_na$value = as.numeric(subset_na$value)
c.max <- max(subset_na$value,na.rm=TRUE)
c.min.year = min(subset_na$year,na.rm=T)
c.max.year = max(subset_na$year,na.rm=T)
c.year.step = round((c.max.year-c.min.year)/4)
c.year.seq = seq(c.min.year,c.max.year,max(c.year.step,1))
fill=scale_fill_manual(values=yellow)
color=scale_color_manual(values=yellow)
disagg.value = rep(1,nrow(subset_na))
c56 = ggplot(subset_na,aes(year,value)) +
geom_line(group=1,show.legend=T,size=2,color=yellow) +
fill +
color +
guides(fill=guide_legend(title=element_blank(),byrow=TRUE),color=F) +
simple_style  +
scale_x_continuous(labels=round,breaks=c.year.seq) +
scale_y_continuous(expand = c(0,0),limits=c(0,max(c.max*1.1,1))) +
# expand_limits(y=c1a.max*1.1) +
theme(
legend.position="top"
,legend.text = element_text(size=30,color=blue,family="Averta Regular")
,legend.justification=c(0,0)
,legend.direction="vertical"
,axis.title.x=element_blank()
,axis.title.y=element_text(size=40,color=blue, angle=90, margin=margin(t=0,r=10,b=0,l=0), hjust=1,family="Averta Regular")
,axis.ticks=element_blank()
,axis.line.y = element_line(color=blue, size = 1.1)
,axis.line.x = element_line(color=blue, size = 1.1)
,axis.text.y = element_blank()
,axis.text.x = element_text(size=40,color=blue,margin=margin(t=20,r=0,b=0,l=0),family="Averta Regular")
,legend.background = element_rect(fill = "transparent", colour = "transparent")
,legend.key = element_blank()
) +
labs(y = "Prevalence %") +
geom_text_repel(size=15,color=blue,aes(group=disagg.value,label=round(as.numeric(firstAndLast(value,year,disagg.value)),digits=1)),vjust=-0.5,show.legend=F,family="Averta Regular",segment.colour="transparent")
} else {c56 = NULL}
c35
